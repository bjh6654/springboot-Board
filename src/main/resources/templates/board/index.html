<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시판</title>
  <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
    }

    /* 헤더 */
    header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .header-left h1 {
        font-size: 24px;
        font-weight: 600;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-email {
        font-size: 14px;
        opacity: 0.9;
    }

    .logout-btn {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        text-decoration: none;
    }

    .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .login-link {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s;
        display: inline-block;
    }

    .login-link:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    /* 메인 컨테이너 */
    .container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .board-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .board-title {
        font-size: 28px;
        color: #333;
        font-weight: 600;
    }

    .search-box {
        display: flex;
        gap: 8px;
    }

    .search-box input {
        padding: 10px 16px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        width: 250px;
    }

    .search-box button {
        padding: 10px 20px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
    }

    .search-box button:hover {
        background: #5568d3;
    }

    /* 게시판 테이블 */
    .board-table {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 30px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: #f9f9f9;
        border-bottom: 2px solid #ddd;
    }

    th {
        padding: 16px;
        text-align: left;
        font-weight: 600;
        color: #333;
        font-size: 14px;
    }

    td {
        padding: 8px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        color: #555;
    }

    tbody tr {
        transition: background 0.2s;
    }

    tbody td {
      padding-left: 16px;
    }

    tbody tr:hover {
        background: #e9e9e9;
        transition: background 0.2s;
    }

    .post-id {
        text-align: left;
    }

    .post-title {
        color: #667eea;
        font-weight: 500;
        text-decoration-line: none;
        text-align: left;
    }

    .post-title:hover {
        text-decoration: underline;
    }

    .post-author {
        color: #999;
        text-align: left;
    }

    .post-date {
        color: #999;
        text-align: left;
    }

    .post-views {
        color: #999;
        text-align: center;
    }

    /* 페이지네이션 */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 30px;
    }

    .pagination a,
    .pagination span {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        text-decoration: none;
        color: #667eea;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .pagination div {
      padding: 8px 4px;
    }


    .pagination a:hover {
        background: #667eea;
        color: white;
    }

    .pagination .active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .pagination .disabled {
        color: #ccc;
        cursor: not-allowed;
    }

    /* 하단 버튼 영역 */
    .board-footer {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
    }

    .write-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .write-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .write-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
    }

    /* 빈 상태 */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 8px;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        color: #ddd;
    }

    .empty-state-text {
        color: #999;
        font-size: 16px;
    }

    /* 알림 */
    .alert {
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
        font-size: 14px;
    }

    .alert.success {
        background: #e6f4ea;
        color: #137333;
        border: 1px solid #34a853;
        display: block;
    }

    .alert.error {
        background: #fce8e6;
        color: #c5221f;
        border: 1px solid #ea4335;
        display: block;
    }

    /* 반응형 */
    @media (max-width: 768px) {
        header {
            flex-direction: column;
            gap: 16px;
            padding: 16px;
        }

        .header-right {
            width: 100%;
            justify-content: space-between;
        }

        .board-header {
            flex-direction: column;
            gap: 16px;
            align-items: flex-start;
        }

        .search-box {
            width: 100%;
        }

        .search-box input {
            flex: 1;
        }

        table {
            font-size: 12px;
        }

        th, td {
            padding: 12px 8px;
        }

        .board-footer {
            justify-content: center;
        }
    }
  </style>
</head>
<body>
<!-- 헤더 -->
<header>
  <div class="header-left">
    <h1>게시판</h1>
  </div>
  <div class="header-right">
<!--    <div class="user-info" th:if="${#authentication.principal.username != 'anonymousUser'}">-->
<!--      <span class="user-email" th:text="${#authentication.principal.username}"></span>-->
<!--      <form action="/logout" method="post" style="margin: 0;">-->
<!--        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">-->
<!--        <button type="submit" class="logout-btn">로그아웃</button>-->
<!--      </form>-->
<!--    </div>-->
    <div sec:authorize="isAuthenticated()">
      <span th:text="${memberDTO.name}"></span>
      <a href="/auth/logout" class="login-link">로그아웃</a>
    </div>
    <div sec:authorize="isAnonymous()">
      <a href="/auth/loginPage" class="login-link">로그인</a>
    </div>
<!--    <div th:unless="${#authentication.principal.username != 'anonymousUser'}">-->

<!--    </div>-->
  </div>
</header>

<!-- 메인 컨테이너 -->
<div class="container">
<!--  &lt;!&ndash; 알림 메시지 &ndash;&gt;-->
<!--  <div class="alert success" th:if="${param.success}">-->
<!--    ✓ 글이 등록되었습니다.-->
<!--  </div>-->
<!--  <div class="alert error" th:if="${param.error}">-->
<!--    ✗ 오류가 발생했습니다.-->
<!--  </div>-->

  <!-- 게시판 헤더 -->
  <div class="board-header">
    <h2 class="board-title">게시글</h2>
    <form class="search-box" method="get" th:action="@{/board}">
      <input type="text" name="keyword" placeholder="제목 또는 내용으로 검색..." th:value="${keyword}">
      <button type="submit">검색</button>
    </form>
  </div>

  <!-- 게시판 테이블 -->
  <div class="board-table">
    <table>
      <thead>
      <tr>
        <th style="width: 10%;">번호</th>
        <th style="width: 50%;">제목</th>
        <th style="width: 15%;">작성자</th>
        <th style="width: 15%;">작성일</th>
        <th style="width: 10%; text-align: center;">조회</th>
      </tr>
      </thead>
      <tbody>
      <!-- 게시글 목록 -->
      <tr th:each="post, stat : ${boardDTO.postList}">
        <td class="post-id" th:text="${post.id}"></td>
        <td>
          <a th:href="@{/board/post(postId=${post.id})}"
             class="post-title"
             th:text="${post.title} + (${post.replyCount > 0} ? ' (' + ${post.replyCount} + ')' : '')">
          </a>
        </td>
        <td class="post-author" th:text="${post.authorName}"></td>
        <td class="post-date" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
        <td class="post-views" th:text="${post.viewCount}"></td>
      </tr>

      <!-- 빈 상태 -->
      <tr th:if="${#lists.isEmpty(boardDTO.postList)}">
        <td colspan="5">
          <div class="empty-state">
            <div class="empty-state-text">게시글이 없습니다.</div>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- 페이지네이션 -->
  <div class="pagination" th:if="${boardDTO.totalPages > 0}">
    <!-- 이전 페이지 -->
    <a th:if="${boardDTO.currentPage > 0}" th:href="@{/board(page=${boardDTO.currentPage - 1}, keyword=${keyword})}">← 이전</a>
<!--    <span th:if="${currentPage <= 1}" class="disabled">← 이전</span>-->

    <!-- 페이지 번호 -->
    <div th:each="page : ${#numbers.sequence(0, boardDTO.totalPages - 1)}">
        <a th:if="${page != boardDTO.currentPage}"
           th:href="@{/board(page=${page}, keyword=${keyword})}"
           th:text="${page+1}"></a>
        <span th:if="${page == boardDTO.currentPage}" class="active" th:text="${page+1}"></span>
    </div>

    <!-- 다음 페이지 -->
    <a th:if="${boardDTO.currentPage < boardDTO.getTotalPages()-1}" th:href="@{/board(page=${boardDTO.currentPage + 1}, keyword=${keyword})}">다음 →</a>
<!--    <span th:if="${currentPage >= totalPages}" class="disabled">다음 →</span>-->
  </div>

  <!-- 하단 버튼 영역 -->
  <div class="board-footer">
    <a href="/board/post/create" class="write-btn">
      ✏️ 글쓰기
    </a>
  </div>
</div>
</body>
</html>
